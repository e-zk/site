<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="#101010" name="theme-color"/>
<link href="/favicon.svg" rel="icon" sizes="any" type="image/svg+xml">
<link href="/favicon.ico" rel="alternate icon">
<link href="/static/css/main.css" rel="stylesheet">
<meta http-equiv="onion-location" content="http://64wv2uqwjacqer7z5d6ooqgrvjwlioizmo7hgmxm7zxerbvgnoqhafid.onion/posts/2021-01-04-xenodm.html">
<title>My xenodm setup</title>
<meta property="og:title" content="My xenodm setup">
</head>
<body>
<header>
<nav>
<a href="/">zakaria.org</a><a href="/posts/">posts</a><a href="/projects.html">code</a><a style="float:right" href="/about.html">about</a></nav>
</header>
<main>
<h1 id="My%20xenodm%20setup">My xenodm setup</h1>

<p>OpenBSD uses the <a href="https://man.openbsd.org/xenodm"><code>xenodm(1)</code></a> display manager, which is a fork of xdm.<br/>
Xenodm looks quite ugly by default, and after reading a couple<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> of<sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup> articles<sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup> on themeing xenodm I&#8217;ve come up with my own setup.</p>

<p>Before we get into the configs, here&#8217;s what it actually looks like:</p>

<p><a href="/static/img/xenodm.png"><img src="/static/img/xenodm.png" alt="themed xenodm" /></a></p>

<p><em>(The text might be small, click to view the image file)</em></p>

<p>Clean and simple. Now that you&#8217;ve seen what it looks like you can close this tab if that&#8217;s all you came here to see. If you want to see how this is accomplished then continue reading.</p>

<h2 id="Files">Files</h2>

<p>xenodm uses multiple files for configuration. It&#8217;s quite inconvenient, and I was very confused at first I admit. The files we&#8217;ll have to deal with are:</p>

<pre><code>&#47;etc&#47;X11&#47;xenodm&#47;Xresources
&#47;etc&#47;X11&#47;xenodm&#47;Xsetup_0
&#47;etc&#47;X11&#47;xenodm&#47;Xsession
</code></pre>

<p>The last one is for an optional non-cosmetic change that I&#8217;ll cover later. All these files require root access, so it&#8217;d be wise to <code>doas -s</code> before continuing on.</p>

<h2 id="Xresources">Xresources</h2>

<p>If you&#8217;ve ever dabbled in trying to rice your Unix-like operating system there&#8217;s a good change you&#8217;ve come across an <a href="https://wikipedia.org/wiki/X_resources">Xresources</a> file before. The X window system uses a &#8220;resource database&#8221; as a &#8216;unified&#8217; way to store configuration data.</p>

<p>xenodm sources the Xresources file before loading. Using entries in the Xresources file we can configure what the login widget (the place we type our username + password) looks like.</p>

<p>First off, I&#8217;d like to be able to see my password being entered as I type with little <code>*</code> as it so commonly is.</p>

<pre><code>xlogin.Login.echoPasswd: true
</code></pre>

<p>Next I don&#8217;t want to be &#8216;greeted&#8217;, and I want the message when I put my password in incorrectly to be <code>ya dun goofed</code>:</p>

<pre><code>xlogin.Login.fail: ya dun goofed
xlogin.Login.greeting:
</code></pre>

<p>Now I&#8217;ll configure the dimensions and positioning of the login box:</p>

<pre><code>xlogin.Login.height:            200
xlogin.Login.width:             400
xlogin.Login.y:                 320
xlogin.Login.frameWidth:        10
xlogin.Login.innerFramesWidth:  0
</code></pre>

<p>Add some colour (or lack thereof):</p>

<pre><code>xlogin.Login.background:        #000000
xlogin.Login.foreground:        #eeeeee
xlogin.Login.failColor:         #b00035
xlogin.Login.inpColor:          #000000
xlogin.Login.promptColor:       #eeeeee
xlogin.Login.hiColor:           #000000
xlogin.Login.shdColor:          #000000
</code></pre>

<p>And finally let&#8217;s use a nice bitmap font to complete the look:</p>

<pre><code>xlogin.Login.face:              Dina-11
xlogin.Login.failFace:          Dina-11
xlogin.Login.promptFace:        Dina-11
</code></pre>

<p>Note that last step requires the Dina font to be installed (it does not come with OpenBSD).</p>

<h2 id="Xsetup_0">Xsetup_0</h2>

<p>Next is the Xsetup file. Why is this called Xsetup_<em>0</em>? Because xenodm can be configured to run multiple X display servers, and the main one is 0, hence the 0 (check out <code>&#47;etc&#47;X11&#47;xenodm&#47;xenodm-config</code>).</p>

<p>This file is fairly simple. It&#8217;s a shell script that xenodm runs. That&#8217;s it. Simple as that. Through this script we can run pretty much any program we like. In my case, a simple lemonbar script:</p>

<pre><code>#!&#47;bin&#47;sh

# set background
&#47;usr&#47;X11R6&#47;bin&#47;xsetroot -solid \#000000

# add Dina font to font list
&#47;usr&#47;X11R6&#47;bin&#47;xset fp+ &#47;usr&#47;local&#47;share&#47;font&#47;dina
 
# status bar
(
while true; do
        reboot="%{F#b00035}%{A:reboot:} r %{A}%{F-}"
        shutdown="%{F#b00035}%{A:shutdown -p now:} p %{A}%{F-}"

        echo "  $(date &#39;+%T&#39;)  %{r}${reboot}&#47;${shutdown}  $(date &#39;+%F&#39;)    $(apm -l)%  "
        sleep 1
done | &#47;home&#47;zzz&#47;bin&#47;lemonbar -d -g 1920x40+0+0 -f &#39;Dina:style=Medium:pixelsize=13&#39; -B \#000000 -F \#eeeeee | sh
) &#38;

# uncomment to take &#39;screenshot&#39;
#(sleep 5 &#38;&#38; xwd -out &#47;tmp&#47;xenodm.xwd -root) &#38;
</code></pre>

<p>The date, time, battery percent are all piped into lemonbar. Additionally the &#8216;r&#8217; and &#8216;p&#8217; text in red allow me to reboot or power off my machine respectively.</p>

<p>It should be noted that I probably shouldn&#8217;t be using a binary that&#8217;s located in my user writable home directory here. Check the footnotes for other options, namely using xmessage and&#47;or xclock. Or you can just take out the lemonbar bit entirely, which I will likely do in the future.</p>

<h2 id="Xsession%20extra">Xsession extra</h2>

<p>Here&#8217;s the optional bit. I&#8217;m a big fan of <a href="https://github.com/vizs/declutter-home">decluttering</a> my home directory. Moving as many dotfiles out of <code>$HOME&#47;</code> as possible. Moving <code>~&#47;.Xresources</code> was easy - just source a different file from <code>~&#47;.xsession</code>. But an annoyance is <code>~&#47;.xsession</code> itself, which up until now I had no idea how to move. Turns out its location can be changed in <code>&#47;etc&#47;X11&#47;xenodm&#47;Xsession</code>!</p>

<p>Look for the line that says:</p>

<pre><code>startup=$HOME&#47;.xsession
</code></pre>

<p>Here we can change the <code>startup</code> variable to be any path we like:</p>

<pre><code>startup=${HOME}&#47;etc&#47;x&#47;xsession
</code></pre>

<p>Also, if you&#8217;ve themed <a href="https://man.openbsd.org/ssh-askpass"><code>ssh-askpass(1)</code></a> like I have and want to actually see those changes when it prompts for your ssh key password then you should probably source your user Xresources before running all the ssh-related stuff.</p>

<p>Look for this part of the script:</p>

<pre><code># if we have private ssh key(s), start ssh-agent and add the key(s)
id1=$HOME&#47;.ssh&#47;identity
id2=$HOME&#47;.ssh&#47;id_dsa
id3=$HOME&#47;.ssh&#47;id_rsa
id4=$HOME&#47;.ssh&#47;id_ecdsa
id5=$HOME&#47;.ssh&#47;id_ed25519
if [ -z "$SSH_AGENT_PID" ];
then
    if [ -x &#47;usr&#47;bin&#47;ssh-agent ] &#38;&#38; [ -f $id1 -o -f $id2 -o -f $id3 -o -f $id4 -o -f $id5 ];
    then
        eval `ssh-agent -s`
        ssh-add &#60; &#47;dev&#47;null
    fi
fi
</code></pre>

<p>Just anywhere above this section simply add <code>xrdb -load $HOME&#47;path&#47;to&#47;xresources</code>.</p>

<div class="footnotes">
<hr/>
<ol>

<li id="fn1">
<p><a href="https://www.tumfatig.net/20190208/customizing-openbsd-xenodm/">https:&#47;&#47;www.tumfatig.net&#47;20190208&#47;customizing-openbsd-xenodm&#47;</a><br/>
this is the first article I read on the subject&#160;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

<li id="fn2">
<p><a href="https://www.vincentdelft.be/post/post_20190720">https:&#47;&#47;www.vincentdelft.be&#47;post&#47;post_20190720</a>&#160;<a href="#fnref2" rev="footnote">&#8617;</a></p>
</li>

<li id="fn3">
<p><a href="https://www.romanzolotarev.com/openbsd/xenodm.html">https:&#47;&#47;www.romanzolotarev.com&#47;openbsd&#47;xenodm.html</a><br/>
this article is the basis for my configuration, stylistically and config-wise.&#160;<a href="#fnref3" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>
</main>
<footer>
<br><hr>
<p>posted: [&nbsp;2021-01-04&nbsp;]</p>
<p>view: [&nbsp;<a href="/posts/2021-01-04-xenodm.md">plaintext</a>&nbsp;|&nbsp;<a href="http://64wv2uqwjacqer7z5d6ooqgrvjwlioizmo7hgmxm7zxerbvgnoqhafid.onion/posts/2021-01-04-xenodm.html">hidden service</a>&nbsp;]</p>
<div class="qrbox">
<details class="qr"><summary>show qr: [ clear net ]</summary> <!-- Created with qrencode 4.1.1 (https://fukuchi.org/works/qrencode/index.html) -->
<svg width="3.92cm" height="3.92cm" viewBox="0 0 37 37" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
	<g id="QRcode">
		<rect x="0" y="0" width="37" height="37" fill="#ffffff"/>
		<path style="stroke:#000000" transform="translate(4,4.5)" d="M0,0h7M8,0h1M11,0h2M14,0h1M17,0h1M22,0h7M0,1h1M6,1h1M9,1h2M16,1h4M22,1h1M28,1h1M0,2h1M2,2h3M6,2h1M10,2h1M12,2h5M20,2h1M22,2h1M24,2h3M28,2h1M0,3h1M2,3h3M6,3h1M12,3h1M14,3h1M16,3h2M19,3h2M22,3h1M24,3h3M28,3h1M0,4h1M2,4h3M6,4h1M9,4h1M11,4h1M13,4h3M17,4h1M19,4h1M22,4h1M24,4h3M28,4h1M0,5h1M6,5h1M10,5h1M12,5h1M14,5h4M22,5h1M28,5h1M0,6h7M8,6h1M10,6h1M12,6h1M14,6h1M16,6h1M18,6h1M20,6h1M22,6h7M8,7h1M10,7h2M14,7h2M18,7h3M0,8h2M3,8h2M6,8h1M9,8h4M17,8h1M19,8h2M22,8h1M28,8h1M0,9h1M2,9h1M5,9h1M9,9h1M12,9h5M19,9h1M21,9h1M23,9h2M26,9h2M2,10h3M6,10h3M10,10h3M16,10h1M18,10h1M21,10h1M24,10h1M26,10h1M5,11h1M9,11h6M16,11h2M19,11h2M23,11h3M28,11h1M1,12h1M6,12h1M8,12h2M11,12h3M15,12h1M18,12h1M20,12h1M22,12h2M28,12h1M3,13h1M8,13h1M12,13h1M14,13h1M16,13h1M18,13h1M20,13h1M22,13h7M2,14h1M6,14h1M8,14h4M13,14h3M18,14h4M23,14h1M26,14h1M28,14h1M1,15h3M5,15h1M7,15h2M13,15h1M15,15h2M18,15h2M21,15h2M26,15h1M28,15h1M1,16h1M3,16h1M6,16h1M8,16h3M12,16h2M15,16h2M20,16h1M23,16h1M25,16h1M0,17h1M2,17h2M9,17h2M12,17h2M15,17h1M17,17h4M24,17h1M26,17h2M0,18h3M5,18h4M13,18h1M16,18h1M19,18h4M24,18h2M28,18h1M0,19h2M3,19h2M14,19h1M17,19h1M20,19h2M24,19h3M0,20h4M6,20h2M11,20h3M15,20h2M18,20h10M8,21h3M12,21h3M16,21h1M19,21h2M24,21h2M0,22h7M9,22h2M12,22h1M15,22h1M17,22h4M22,22h1M24,22h2M0,23h1M6,23h1M13,23h2M16,23h2M19,23h2M24,23h1M27,23h2M0,24h1M2,24h3M6,24h1M8,24h1M12,24h1M14,24h1M17,24h9M27,24h1M0,25h1M2,25h3M6,25h1M8,25h1M12,25h3M16,25h1M18,25h1M27,25h1M0,26h1M2,26h3M6,26h1M9,26h1M13,26h3M18,26h1M20,26h2M23,26h2M26,26h3M0,27h1M6,27h1M8,27h1M10,27h1M13,27h1M16,27h1M18,27h1M21,27h1M25,27h2M28,27h1M0,28h7M8,28h1M10,28h1M12,28h1M15,28h1M17,28h1M19,28h5M25,28h1"/>
	</g>
</svg> </details>
<details class="qr"><summary>show qr: [ onion url ]</summary> <!-- Created with qrencode 4.1.1 (https://fukuchi.org/works/qrencode/index.html) -->
<svg width="4.76cm" height="4.76cm" viewBox="0 0 45 45" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
	<g id="QRcode">
		<rect x="0" y="0" width="45" height="45" fill="#ffffff"/>
		<path style="stroke:#000000" transform="translate(4,4.5)" d="M0,0h7M10,0h1M12,0h2M16,0h6M23,0h1M25,0h1M28,0h1M30,0h7M0,1h1M6,1h1M8,1h1M10,1h1M13,1h5M20,1h3M24,1h2M27,1h1M30,1h1M36,1h1M0,2h1M2,2h3M6,2h1M12,2h1M14,2h2M18,2h5M24,2h1M28,2h1M30,2h1M32,2h3M36,2h1M0,3h1M2,3h3M6,3h1M8,3h3M12,3h1M15,3h1M17,3h3M22,3h2M25,3h4M30,3h1M32,3h3M36,3h1M0,4h1M2,4h3M6,4h1M9,4h1M13,4h1M15,4h1M17,4h7M26,4h1M28,4h1M30,4h1M32,4h3M36,4h1M0,5h1M6,5h1M8,5h2M11,5h2M14,5h1M17,5h1M20,5h1M24,5h4M30,5h1M36,5h1M0,6h7M8,6h1M10,6h1M12,6h1M14,6h1M16,6h1M18,6h1M20,6h1M22,6h1M24,6h1M26,6h1M28,6h1M30,6h7M9,7h3M13,7h1M21,7h1M23,7h2M26,7h1M0,8h5M6,8h4M11,8h1M13,8h1M16,8h2M19,8h1M22,8h2M25,8h5M31,8h1M33,8h1M35,8h1M0,9h3M4,9h2M7,9h1M10,9h1M12,9h2M19,9h3M23,9h1M25,9h1M28,9h2M31,9h1M34,9h1M3,10h1M6,10h1M8,10h1M14,10h1M16,10h1M18,10h1M26,10h3M30,10h3M34,10h1M36,10h1M7,11h2M12,11h4M18,11h4M23,11h1M28,11h3M33,11h1M1,12h1M3,12h2M6,12h1M8,12h1M10,12h1M12,12h1M14,12h4M19,12h1M22,12h1M25,12h3M29,12h2M32,12h3M2,13h1M5,13h1M7,13h4M13,13h1M15,13h11M28,13h1M31,13h1M34,13h2M1,14h7M10,14h3M14,14h4M20,14h1M22,14h1M27,14h5M34,14h1M36,14h1M0,15h1M2,15h1M5,15h1M7,15h1M11,15h1M13,15h2M19,15h3M26,15h2M29,15h2M33,15h1M36,15h1M1,16h2M4,16h1M6,16h3M10,16h2M13,16h5M19,16h1M22,16h9M32,16h1M34,16h1M36,16h1M1,17h1M3,17h1M5,17h1M10,17h1M12,17h2M16,17h1M19,17h3M23,17h1M25,17h1M28,17h2M31,17h1M35,17h1M0,18h1M3,18h6M14,18h1M17,18h2M22,18h1M24,18h5M30,18h1M32,18h5M1,19h1M3,19h2M8,19h3M12,19h2M15,19h1M19,19h4M24,19h1M26,19h1M28,19h1M32,19h2M36,19h1M5,20h2M9,20h2M12,20h1M15,20h1M17,20h1M19,20h1M22,20h2M25,20h2M30,20h1M32,20h1M34,20h3M0,21h6M7,21h3M13,21h1M15,21h1M19,21h1M23,21h1M25,21h1M28,21h2M31,21h1M35,21h1M2,22h1M5,22h3M9,22h1M11,22h2M14,22h2M22,22h1M27,22h7M35,22h2M0,23h1M5,23h1M7,23h3M11,23h1M13,23h3M18,23h1M20,23h2M26,23h1M28,23h2M31,23h1M36,23h1M1,24h1M6,24h3M11,24h3M16,24h2M22,24h5M29,24h4M34,24h3M0,25h5M9,25h2M12,25h1M15,25h2M19,25h2M23,25h1M25,25h2M28,25h2M31,25h1M35,25h1M0,26h1M3,26h2M6,26h5M12,26h1M14,26h5M20,26h1M22,26h1M25,26h1M27,26h1M31,26h1M34,26h3M0,27h1M4,27h2M10,27h1M12,27h4M21,27h3M28,27h1M36,27h1M0,28h1M2,28h1M5,28h2M9,28h1M12,28h1M14,28h2M17,28h3M22,28h1M24,28h9M34,28h1M8,29h1M12,29h2M15,29h2M18,29h6M25,29h1M28,29h1M32,29h1M0,30h7M8,30h2M11,30h1M14,30h2M18,30h1M21,30h1M24,30h1M26,30h1M28,30h1M30,30h1M32,30h5M0,31h1M6,31h1M9,31h2M14,31h2M18,31h5M24,31h1M26,31h3M32,31h2M35,31h1M0,32h1M2,32h3M6,32h1M8,32h1M11,32h2M15,32h1M17,32h1M22,32h11M34,32h1M0,33h1M2,33h3M6,33h1M8,33h1M11,33h3M15,33h1M18,33h3M23,33h1M25,33h1M27,33h1M30,33h4M36,33h1M0,34h1M2,34h3M6,34h1M8,34h1M11,34h1M13,34h5M20,34h2M25,34h2M29,34h1M31,34h1M33,34h4M0,35h1M6,35h1M8,35h2M13,35h1M15,35h1M17,35h1M21,35h1M23,35h1M26,35h6M36,35h1M0,36h7M8,36h1M11,36h2M15,36h2M18,36h1M22,36h1M25,36h1M29,36h3M34,36h3"/>
	</g>
</svg> </details>
</div>
(C) <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
</footer>
</body>
</html>
