<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="#101010" name="theme-color"/>
<link href="/favicon.svg" rel="icon" sizes="any" type="image/svg+xml">
<link href="/favicon.ico" rel="alternate icon">
<link href="/static/css/main.css" rel="stylesheet">
<meta http-equiv="onion-location" content="http://64wv2uqwjacqer7z5d6ooqgrvjwlioizmo7hgmxm7zxerbvgnoqhafid.onion/posts/2020-08-03-m4.html">
<title>M4 Troubles</title>
<meta property="og:title" content="M4 Troubles">
<meta property="og:description" content="Maybe m4 isn't such a good idea">
</head>
<body>
<header>
<nav>
<a href="/">zakaria.org</a><a href="/posts/">posts</a><a href="/projects.html">code</a><a class="right" href="/about.html">about</a></nav>
</header>
<main>
<h1 id="M4%20Troubles&amp;#8230;">M4 Troubles&#8230;</h1>

<p>In my <a href="https://zakaria.org/posts/2020-08-01-shblog">previous post</a> I wrote about mostly M4 templates.
Well, it turns out I&#8217;ve run into some issues.</p>

<h2 id="Chapter%20I:%20The%20Problem">Chapter I: The Problem</h2>

<p>I ran my blog script to convert my markdown into a nice HTML webpage, but then something happened. Nothing. Nothing happened. The script just sat there, stuck. This was odd because the script usually runs in under a second, so something had to have gone wrong&#8230;</p>

<h2 id="Chapter%20II:%20The%20Quick%20Fix">Chapter II: The Quick Fix</h2>

<p>I turned on tracing in my <code>head.m4</code> by adding <code>traceon</code> to the start of the file then I ran the script again. I knew instantly what had gone wrong&#8230; M4 was spitting out the same HTML over and over and over again: It was expanding the macros I had written in my post! Creating an infinite loop.</p>

<p>As a quick fix in the post I replaced all occurrences of my actual macros with ones that were slightly different. It worked! &#8230;but then M4 gave another error: </p>

<pre><code>m4: unexpected end of input, unclosed parenthesis:
</code></pre>

<h2 id="Chapter%20III:%20The%20Root%20of%20All%20Evil">Chapter III: The Root of All Evil</h2>

<p>In my search for answers I came across this post: <a href="http://silas.net.br/tech/devel/m4.html">http:&#47;&#47;silas.net.br&#47;tech&#47;devel&#47;m4.html</a>. While the particular issue in on the webpage wasn&#8217;t <em>my</em> issue, it gave me a hint as to what had gone wrong. M4 must have been trying to expand or evaluate something else in my post&#8217;s text. Eventually I figured out that M4 was trying to run all the <code>define()</code> and <code>include()</code> statements I had written in my post. Needless to say, writing a post about M4 while using M4 for my templates was causing some issues&#8230;</p>

<p>As a crappy bandaid I added a couple of <code>sed</code>s to my script:</p>

<pre><code>article_html=$(echo "$article_html" |  sed -E -e "s&#47;define\(&#47;\&#39;!define\(!\"&#47;g" -e "s&#47;include\(&#47;\&#39;!include\(!\"&#47;g")
</code></pre>

<p>Because I only wrote <code>define</code> and <code>include</code> in my M4 code snippets for the post, this worked just fine. (Hopefully it works for this post too).</p>

<p>I may have to rethink using M4 completely because I won&#8217;t lie I have no idea what I&#8217;m doing - it seems like I&#8217;m bound to run into this issue or a similar one in the future. Maybe Timmy was wrong; maybe I should just <code>echo</code> a bunch of HTML in my script instead, surely it can&#8217;t be that messy. We&#8217;ll have to see what I come up with.</p>

<h2 id="Chapter%20IV:%20Going%20Forward">Chapter IV: Going Forward</h2>

<p>For now, consider my <a href="https://zakaria.org/posts/2020-08-01-shblog">previous post</a> to be non-cannon in the <code>&#47;bin&#47;sh</code> blog series (if you can really call it a series - there hasn&#8217;t even been a part II yet!).</p>
</main>
<footer>
<br><hr>
<p>posted: [&nbsp;2020-08-03&nbsp;]</p>
<p>view: [&nbsp;<a href="/posts/2020-08-03-m4.md">plaintext</a>&nbsp;|&nbsp;<a href="http://64wv2uqwjacqer7z5d6ooqgrvjwlioizmo7hgmxm7zxerbvgnoqhafid.onion/posts/2020-08-03-m4.html">hidden service</a>&nbsp;]</p>
<div class="qrbox">
<details class="qr"><summary>show qr: [ clear net ]</summary> <svg width="3.92cm" height="3.92cm" viewBox="0 0 37 37" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
	<g id="QRcode">
		<rect x="0" y="0" width="37" height="37" fill="#ffffff"/>
		<path style="stroke:#000000" transform="translate(4,4.5)" d="M0,0h7M8,0h1M11,0h2M14,0h1M17,0h1M22,0h7M0,1h1M6,1h1M9,1h2M13,1h1M15,1h1M17,1h3M22,1h1M28,1h1M0,2h1M2,2h3M6,2h1M10,2h1M12,2h1M14,2h3M20,2h1M22,2h1M24,2h3M28,2h1M0,3h1M2,3h3M6,3h1M12,3h3M16,3h2M19,3h2M22,3h1M24,3h3M28,3h1M0,4h1M2,4h3M6,4h1M9,4h1M11,4h1M14,4h2M17,4h1M19,4h1M22,4h1M24,4h3M28,4h1M0,5h1M6,5h1M10,5h1M12,5h6M22,5h1M28,5h1M0,6h7M8,6h1M10,6h1M12,6h1M14,6h1M16,6h1M18,6h1M20,6h1M22,6h7M8,7h1M10,7h2M14,7h1M18,7h3M0,8h2M3,8h2M6,8h1M9,8h3M13,8h1M15,8h3M19,8h2M22,8h1M28,8h1M0,9h2M5,9h1M7,9h1M9,9h1M12,9h1M14,9h2M19,9h1M21,9h1M23,9h2M26,9h2M0,10h3M5,10h4M10,10h2M15,10h2M18,10h1M21,10h1M24,10h1M26,10h1M1,11h5M7,11h8M16,11h2M19,11h2M23,11h3M28,11h1M3,12h1M6,12h1M9,12h1M11,12h3M15,12h1M18,12h1M20,12h1M22,12h2M28,12h1M1,13h1M3,13h2M7,13h1M14,13h1M16,13h1M18,13h1M20,13h1M22,13h7M1,14h1M5,14h2M9,14h7M18,14h4M23,14h1M26,14h1M28,14h1M3,15h3M8,15h1M11,15h1M15,15h2M18,15h2M21,15h2M26,15h1M28,15h1M0,16h1M4,16h6M14,16h3M20,16h1M23,16h1M25,16h1M0,17h1M2,17h1M8,17h1M10,17h4M15,17h1M17,17h4M24,17h1M26,17h2M0,18h4M5,18h2M8,18h1M11,18h1M15,18h2M19,18h4M24,18h2M28,18h1M0,19h2M4,19h2M8,19h1M10,19h1M12,19h1M14,19h1M16,19h2M20,19h2M24,19h3M0,20h2M3,20h4M8,20h3M12,20h2M15,20h2M18,20h10M8,21h1M13,21h2M16,21h1M19,21h2M24,21h2M0,22h7M12,22h1M15,22h1M17,22h4M22,22h1M24,22h2M0,23h1M6,23h1M9,23h1M13,23h2M17,23h1M19,23h2M24,23h1M27,23h2M0,24h1M2,24h3M6,24h1M8,24h2M12,24h1M14,24h12M27,24h1M0,25h1M2,25h3M6,25h1M8,25h3M12,25h1M14,25h2M18,25h1M27,25h1M0,26h1M2,26h3M6,26h1M9,26h2M12,26h3M16,26h1M18,26h1M20,26h2M23,26h2M26,26h3M0,27h1M6,27h1M8,27h1M10,27h1M12,27h2M16,27h1M18,27h1M21,27h1M25,27h2M28,27h1M0,28h7M8,28h2M11,28h2M14,28h2M17,28h1M19,28h5M25,28h1"/>
	</g>
</svg> </details>
<details class="qr"><summary>show qr: [ onion url ]</summary> <!-- Created with qrencode 4.1.1 (https://fukuchi.org/works/qrencode/index.html) -->
<svg width="4.76cm" height="4.76cm" viewBox="0 0 45 45" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg">
	<g id="QRcode">
		<rect x="0" y="0" width="45" height="45" fill="#ffffff"/>
		<path style="stroke:#000000" transform="translate(4,4.5)" d="M0,0h7M10,0h1M12,0h2M16,0h6M23,0h1M25,0h1M28,0h1M30,0h7M0,1h1M6,1h1M8,1h1M10,1h1M14,1h1M17,1h1M20,1h3M24,1h2M27,1h1M30,1h1M36,1h1M0,2h1M2,2h3M6,2h1M12,2h4M18,2h5M24,2h1M28,2h1M30,2h1M32,2h3M36,2h1M0,3h1M2,3h3M6,3h1M8,3h3M12,3h2M15,3h1M17,3h3M22,3h2M25,3h4M30,3h1M32,3h3M36,3h1M0,4h1M2,4h3M6,4h1M9,4h1M15,4h1M17,4h7M26,4h1M28,4h1M30,4h1M32,4h3M36,4h1M0,5h1M6,5h1M8,5h2M11,5h4M17,5h1M20,5h1M24,5h4M30,5h1M36,5h1M0,6h7M8,6h1M10,6h1M12,6h1M14,6h1M16,6h1M18,6h1M20,6h1M22,6h1M24,6h1M26,6h1M28,6h1M30,6h7M9,7h3M13,7h1M15,7h1M21,7h1M23,7h2M26,7h1M0,8h5M6,8h4M11,8h1M15,8h1M17,8h1M19,8h1M22,8h2M25,8h5M31,8h1M33,8h1M35,8h1M0,9h3M4,9h2M10,9h1M12,9h1M16,9h1M19,9h3M23,9h1M25,9h1M28,9h2M31,9h1M34,9h1M2,10h5M8,10h2M14,10h3M18,10h1M26,10h3M30,10h3M34,10h1M36,10h1M0,11h2M3,11h2M8,11h3M12,11h4M18,11h4M23,11h1M28,11h3M33,11h1M0,12h3M5,12h6M12,12h1M14,12h4M19,12h1M22,12h1M25,12h3M29,12h2M32,12h3M1,13h2M4,13h1M10,13h1M13,13h1M15,13h11M28,13h1M31,13h1M34,13h2M5,14h3M9,14h1M11,14h2M14,14h4M20,14h1M22,14h1M27,14h5M34,14h1M36,14h1M1,15h2M4,15h1M7,15h5M14,15h1M19,15h3M26,15h2M29,15h2M33,15h1M36,15h1M4,16h4M11,16h1M15,16h3M19,16h1M22,16h9M32,16h1M34,16h1M36,16h1M0,17h1M2,17h1M4,17h2M7,17h1M9,17h1M12,17h2M16,17h1M19,17h3M23,17h1M25,17h1M28,17h2M31,17h1M35,17h1M0,18h2M5,18h5M13,18h3M17,18h2M22,18h1M24,18h5M30,18h1M32,18h5M0,19h4M8,19h2M12,19h2M15,19h2M19,19h4M24,19h1M26,19h1M28,19h1M32,19h2M36,19h1M1,20h1M3,20h1M5,20h2M8,20h1M10,20h1M12,20h1M15,20h1M17,20h1M19,20h1M22,20h2M25,20h2M30,20h1M32,20h1M34,20h3M0,21h1M2,21h1M8,21h1M13,21h1M15,21h1M19,21h1M23,21h1M25,21h1M28,21h2M31,21h1M35,21h1M1,22h2M4,22h1M6,22h1M9,22h4M14,22h2M22,22h1M27,22h7M35,22h2M0,23h1M2,23h2M5,23h1M8,23h4M13,23h4M18,23h1M20,23h2M26,23h1M28,23h2M31,23h1M36,23h1M2,24h1M4,24h3M10,24h2M13,24h1M15,24h1M17,24h1M22,24h5M29,24h4M34,24h3M0,25h1M2,25h2M5,25h1M8,25h3M12,25h2M19,25h2M23,25h1M25,25h2M28,25h2M31,25h1M35,25h1M0,26h1M3,26h1M5,26h2M8,26h1M10,26h1M14,26h1M17,26h2M20,26h1M22,26h1M25,26h1M27,26h1M31,26h1M34,26h3M0,27h1M2,27h4M8,27h1M10,27h1M12,27h4M21,27h3M28,27h1M36,27h1M0,28h1M3,28h2M6,28h3M12,28h1M15,28h1M17,28h3M22,28h1M24,28h9M34,28h1M8,29h1M15,29h2M18,29h6M25,29h1M28,29h1M32,29h1M0,30h7M8,30h2M11,30h2M15,30h1M18,30h1M21,30h1M24,30h1M26,30h1M28,30h1M30,30h1M32,30h5M0,31h1M6,31h1M10,31h2M15,31h1M18,31h5M24,31h1M26,31h3M32,31h2M35,31h1M0,32h1M2,32h3M6,32h1M8,32h1M10,32h2M15,32h1M17,32h1M22,32h11M34,32h1M0,33h1M2,33h3M6,33h1M8,33h1M10,33h1M12,33h2M15,33h1M18,33h3M23,33h1M25,33h1M27,33h1M30,33h4M36,33h1M0,34h1M2,34h3M6,34h1M8,34h3M13,34h5M20,34h2M25,34h2M29,34h1M31,34h1M33,34h4M0,35h1M6,35h1M8,35h2M12,35h2M15,35h1M17,35h1M21,35h1M23,35h1M26,35h6M36,35h1M0,36h7M8,36h2M12,36h1M14,36h3M18,36h1M22,36h1M25,36h1M29,36h3M34,36h3"/>
	</g>
</svg> </details>
</div>
(C) <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
</footer>
</body>
</html>
